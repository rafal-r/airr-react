"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = AirrFX;

/**
 * Animation utiliy class. Performs css based transition animations
 */
function AirrFX() {}
/**
 * Animate passed HTML element with power of css transitions
 *
 * @param {HTMLElement} element
 * @param {object} startProps css properties that will be set prior the animation
 * @param {array} transitionProps array of css transition definitions, e.g. ['opacity 700ms ease-in', 'transform .4s ease-out']. Compatibility props like `-webkit-transform` are not needed as they will be added automatically
 * @param {object} endProps target css properties values that animation will go to
 * @param {function} preAnimationCallback callback to call before animation begins
 * @param {integer} endAfter time in miliseconds after which `endCallback` will be invoke
 * @param {function} endCallback function to call after endAfter time parameter is gone
 * @returns {void}
 */


AirrFX.doTransitionAnimation = function (element, startProps, transitionProps, endProps, preAnimationCallback, endAfter, endCallback) {
  element.style.webkitTransition = "none";
  element.style.transition = "none";
  element.offsetHeight;
  element.style.webkitBackfaceVisibility = "hidden";
  element.style.backfaceVisibility = "hidden";

  for (var prop in startProps) {
    if (prop === "transform") {
      element.style.webkitTransform = startProps[prop];
    } // eslint-disable-next-line


    element.style[prop] = startProps[prop];
  }

  var compatibilityString = null;
  var transitionString = transitionProps.join(",");

  if (transitionString.indexOf("transform") !== -1 && transitionString.indexOf("-webkit-transform") === -1) {
    compatibilityString = transitionString.replace("transform", "-webkit-transform");
  }

  if (typeof preAnimationCallback === "function") {
    preAnimationCallback();
  }

  element.offsetHeight;

  if (compatibilityString) {
    element.style.webkitTransition = compatibilityString;
  }

  element.style.webkitTransition = transitionString;

  if (compatibilityString) {
    element.style.transition = compatibilityString;
  }

  element.style.transition = transitionString;
  element.offsetHeight;

  for (var _prop in endProps) {
    if (_prop === "transform") {
      element.style.webkitTransform = endProps[_prop];
    } // eslint-disable-next-line


    element.style[_prop] = endProps[_prop];
  }

  if (typeof endCallback === "function" && endAfter) {
    setTimeout(function () {
      endCallback && endCallback();
    }, endAfter);
  }
};
/**
 * Used by Mayers for leaving animation
 *
 * @param {HTMLElement} dom
 * @param {int} width
 * @param {int} height
 * @param {int} t time in miliseconds
 * @param {string} headTo top,bottom,left,right
 * @param {function} callback
 * @returns {void}
 */


AirrFX.doOverlayOutAnimation = function (dom, width, height, t, headTo, callback) {
  var startProps = {
    opacity: "1"
  };
  var endProps = {
    zIndex: "102",
    opacity: "0",
    webkitTransform: "",
    transform: ""
  };

  if (["top", "bottom"].includes(headTo)) {
    if (headTo === "top") {
      endProps.webkitTransform = "scale(0, 1) translate3d(0,-" + height + "px,0)";
      endProps.transform = "scale(0, 1) translate3d(0,-" + height + "px,0)";
    } else {
      endProps.webkitTransform = "scale(0, 1) translate3d(0," + height + "px,0)";
      endProps.transform = "scale(0, 1) translate3d(0," + height + "px,0)";
    }
  } else {
    if (headTo === "left") {
      endProps.webkitTransform = "scale(1, 0) translate3d(-" + width + "px,0,0)";
      endProps.transform = "scale(1, 0) translate3d(-" + width + "px,0,0)";
    } else {
      endProps.webkitTransform = "scale(1, 0) translate3d(" + width + "px,0,0)";
      endProps.transform = "scale(1, 0) translate3d(" + width + "px,0,0)";
    }
  }

  AirrFX.doTransitionAnimation(dom, startProps, ["opacity ".concat(t, "ms ease-out"), "transform ".concat(t, "ms ease-out")], endProps, null, t, function () {
    dom.style.cssText = "";

    if (typeof callback === "function") {
      callback();
    }
  });
};
/**
 * Used by Mayers for entering animation
 *
 * @param {HTMLElement} dom
 * @param {int} width
 * @param {int} height
 * @param {int} t time in miliseconds
 * @param {string} appearFrom top,bottom,left,right direction from which element will appear on the screen
 * @param {function} callback
 * @returns {void}
 */


AirrFX.doOverlayInAnimation = function (dom, width, height, t, appearFrom, callback) {
  var startProps = {
    opacity: "0",
    webkitTransform: "",
    transform: ""
  };

  if (["top", "bottom"].includes(appearFrom)) {
    if (appearFrom === "bottom") {
      startProps.webkitTransform = "scale(0, 1) translate3d(0," + height + "px,0)";
      startProps.transform = "scale(0, 1) translate3d(0," + height + "px,0)";
    } else {
      startProps.webkitTransform = "scale(0, 1) translate3d(0," + -1 * height + "px,0)";
      startProps.transform = "scale(0, 1) translate3d(0," + -1 * height + "px,0)";
    }
  } else {
    if (appearFrom === "right") {
      startProps.webkitTransform = "scale(1, 0) translate3d(" + width + "px,0,0)";
      startProps.transform = "scale(1, 0) translate3d(" + width + "px,0,0)";
    } else {
      startProps.webkitTransform = "scale(1, 0) translate3d(" + -1 * width + "px,0,0)";
      startProps.transform = "scale(1, 0) translate3d(" + -1 * width + "px,0,0)";
    }
  }

  var endProps = {
    zIndex: "102",
    webkitTransform: "scale(1, 1) translate3d(0,0,0)",
    transform: "scale(1, 1) translate3d(0,0,0)",
    opacity: "1"
  };
  AirrFX.doTransitionAnimation(dom, startProps, ["opacity ".concat(t, "ms ease-out"), "transform ".concat(t, "ms ease-out")], endProps, null, t, function () {
    dom.style.cssText = "";

    if (typeof callback === "function") {
      callback();
    }
  });
};
/**
 * Used for animating scroll in vertical axis
 *
 * @param {HTMLElement} element
 * @param {int} scrollDuration time in miliseconds
 * @param {string} direction top or bottom
 * @returns {void}
 */


AirrFX.doVerticalScrollAnimation = function (element, scrollDuration, direction) {
  if (["top", "bottom"].indexOf(direction) === -1) {
    throw new Error("Invalid direction parameter speciefied");
  }

  var scrollHeight = element.scrollHeight,
      scrollStep = Math.PI / (scrollDuration / 15),
      cosParameter = scrollHeight / 2,
      scrollCount = 0,
      scrollMargin,
      scrollEnd = direction === "top" ? 0 : scrollHeight - element.parentElement.clientHeight;
  var scrollInterval = setInterval(function () {
    if (element.scrollTop !== scrollEnd) {
      scrollCount += 1;
      scrollMargin = cosParameter - cosParameter * Math.cos(scrollCount * scrollStep);

      if (direction === "top") {
        element.scrollTop = element.scrollTop - scrollMargin;
      } else {
        element.scrollTop = element.scrollTop + scrollMargin;
      }
    } else {
      clearInterval(scrollInterval);
    }
  }, 15);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9BaXJyRlgudHMiXSwibmFtZXMiOlsiQWlyckZYIiwiZG9UcmFuc2l0aW9uQW5pbWF0aW9uIiwiZWxlbWVudCIsInN0YXJ0UHJvcHMiLCJ0cmFuc2l0aW9uUHJvcHMiLCJlbmRQcm9wcyIsInByZUFuaW1hdGlvbkNhbGxiYWNrIiwiZW5kQWZ0ZXIiLCJlbmRDYWxsYmFjayIsInN0eWxlIiwid2Via2l0VHJhbnNpdGlvbiIsInRyYW5zaXRpb24iLCJvZmZzZXRIZWlnaHQiLCJ3ZWJraXRCYWNrZmFjZVZpc2liaWxpdHkiLCJiYWNrZmFjZVZpc2liaWxpdHkiLCJwcm9wIiwid2Via2l0VHJhbnNmb3JtIiwiY29tcGF0aWJpbGl0eVN0cmluZyIsInRyYW5zaXRpb25TdHJpbmciLCJqb2luIiwiaW5kZXhPZiIsInJlcGxhY2UiLCJzZXRUaW1lb3V0IiwiZG9PdmVybGF5T3V0QW5pbWF0aW9uIiwiZG9tIiwid2lkdGgiLCJoZWlnaHQiLCJ0IiwiaGVhZFRvIiwiY2FsbGJhY2siLCJvcGFjaXR5IiwiekluZGV4IiwidHJhbnNmb3JtIiwiaW5jbHVkZXMiLCJjc3NUZXh0IiwiZG9PdmVybGF5SW5BbmltYXRpb24iLCJhcHBlYXJGcm9tIiwiZG9WZXJ0aWNhbFNjcm9sbEFuaW1hdGlvbiIsInNjcm9sbER1cmF0aW9uIiwiZGlyZWN0aW9uIiwiRXJyb3IiLCJzY3JvbGxIZWlnaHQiLCJzY3JvbGxTdGVwIiwiTWF0aCIsIlBJIiwiY29zUGFyYW1ldGVyIiwic2Nyb2xsQ291bnQiLCJzY3JvbGxNYXJnaW4iLCJzY3JvbGxFbmQiLCJwYXJlbnRFbGVtZW50IiwiY2xpZW50SGVpZ2h0Iiwic2Nyb2xsSW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsInNjcm9sbFRvcCIsImNvcyIsImNsZWFySW50ZXJ2YWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFQTs7O0FBR2UsU0FBU0EsTUFBVCxHQUF3QixDQUFFO0FBRXpDOzs7Ozs7Ozs7Ozs7OztBQVlBQSxNQUFNLENBQUND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IENTU1N0cmluZ1Byb3BlcnRpZXMgfSBmcm9tIFwiLi9UeXBlc1wiO1xuXG4vKipcbiAqIEFuaW1hdGlvbiB1dGlsaXkgY2xhc3MuIFBlcmZvcm1zIGNzcyBiYXNlZCB0cmFuc2l0aW9uIGFuaW1hdGlvbnNcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQWlyckZYKCk6IHZvaWQge31cblxuLyoqXG4gKiBBbmltYXRlIHBhc3NlZCBIVE1MIGVsZW1lbnQgd2l0aCBwb3dlciBvZiBjc3MgdHJhbnNpdGlvbnNcbiAqXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gKiBAcGFyYW0ge29iamVjdH0gc3RhcnRQcm9wcyBjc3MgcHJvcGVydGllcyB0aGF0IHdpbGwgYmUgc2V0IHByaW9yIHRoZSBhbmltYXRpb25cbiAqIEBwYXJhbSB7YXJyYXl9IHRyYW5zaXRpb25Qcm9wcyBhcnJheSBvZiBjc3MgdHJhbnNpdGlvbiBkZWZpbml0aW9ucywgZS5nLiBbJ29wYWNpdHkgNzAwbXMgZWFzZS1pbicsICd0cmFuc2Zvcm0gLjRzIGVhc2Utb3V0J10uIENvbXBhdGliaWxpdHkgcHJvcHMgbGlrZSBgLXdlYmtpdC10cmFuc2Zvcm1gIGFyZSBub3QgbmVlZGVkIGFzIHRoZXkgd2lsbCBiZSBhZGRlZCBhdXRvbWF0aWNhbGx5XG4gKiBAcGFyYW0ge29iamVjdH0gZW5kUHJvcHMgdGFyZ2V0IGNzcyBwcm9wZXJ0aWVzIHZhbHVlcyB0aGF0IGFuaW1hdGlvbiB3aWxsIGdvIHRvXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBwcmVBbmltYXRpb25DYWxsYmFjayBjYWxsYmFjayB0byBjYWxsIGJlZm9yZSBhbmltYXRpb24gYmVnaW5zXG4gKiBAcGFyYW0ge2ludGVnZXJ9IGVuZEFmdGVyIHRpbWUgaW4gbWlsaXNlY29uZHMgYWZ0ZXIgd2hpY2ggYGVuZENhbGxiYWNrYCB3aWxsIGJlIGludm9rZVxuICogQHBhcmFtIHtmdW5jdGlvbn0gZW5kQ2FsbGJhY2sgZnVuY3Rpb24gdG8gY2FsbCBhZnRlciBlbmRBZnRlciB0aW1lIHBhcmFtZXRlciBpcyBnb25lXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuQWlyckZYLmRvVHJhbnNpdGlvbkFuaW1hdGlvbiA9IGZ1bmN0aW9uKFxuICAgIGVsZW1lbnQ6IEhUTUxFbGVtZW50LFxuICAgIHN0YXJ0UHJvcHM6IENTU1N0cmluZ1Byb3BlcnRpZXMsXG4gICAgdHJhbnNpdGlvblByb3BzOiBzdHJpbmdbXSxcbiAgICBlbmRQcm9wczogQ1NTU3RyaW5nUHJvcGVydGllcyxcbiAgICBwcmVBbmltYXRpb25DYWxsYmFjaz86ICgpID0+IHZvaWQsXG4gICAgZW5kQWZ0ZXI/OiBudW1iZXIsXG4gICAgZW5kQ2FsbGJhY2s/OiAoKSA9PiB2b2lkXG4pIHtcbiAgICBlbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zaXRpb24gPSBcIm5vbmVcIjtcbiAgICBlbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSBcIm5vbmVcIjtcbiAgICBlbGVtZW50Lm9mZnNldEhlaWdodDtcblxuICAgIGVsZW1lbnQuc3R5bGUud2Via2l0QmFja2ZhY2VWaXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgICBlbGVtZW50LnN0eWxlLmJhY2tmYWNlVmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gICAgZm9yIChsZXQgcHJvcCBpbiBzdGFydFByb3BzKSB7XG4gICAgICAgIGlmIChwcm9wID09PSBcInRyYW5zZm9ybVwiKSB7XG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IHN0YXJ0UHJvcHNbcHJvcF07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgICAgKGVsZW1lbnQuc3R5bGUgYXMgYW55KVtwcm9wXSA9IHN0YXJ0UHJvcHNbcHJvcF07XG4gICAgfVxuICAgIGxldCBjb21wYXRpYmlsaXR5U3RyaW5nID0gbnVsbDtcbiAgICBsZXQgdHJhbnNpdGlvblN0cmluZyA9IHRyYW5zaXRpb25Qcm9wcy5qb2luKFwiLFwiKTtcblxuICAgIGlmIChcbiAgICAgICAgdHJhbnNpdGlvblN0cmluZy5pbmRleE9mKFwidHJhbnNmb3JtXCIpICE9PSAtMSAmJlxuICAgICAgICB0cmFuc2l0aW9uU3RyaW5nLmluZGV4T2YoXCItd2Via2l0LXRyYW5zZm9ybVwiKSA9PT0gLTFcbiAgICApIHtcbiAgICAgICAgY29tcGF0aWJpbGl0eVN0cmluZyA9IHRyYW5zaXRpb25TdHJpbmcucmVwbGFjZShcInRyYW5zZm9ybVwiLCBcIi13ZWJraXQtdHJhbnNmb3JtXCIpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgcHJlQW5pbWF0aW9uQ2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBwcmVBbmltYXRpb25DYWxsYmFjaygpO1xuICAgIH1cblxuICAgIGVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuXG4gICAgaWYgKGNvbXBhdGliaWxpdHlTdHJpbmcpIHtcbiAgICAgICAgZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2l0aW9uID0gY29tcGF0aWJpbGl0eVN0cmluZztcbiAgICB9XG5cbiAgICBlbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zaXRpb24gPSB0cmFuc2l0aW9uU3RyaW5nO1xuICAgIGlmIChjb21wYXRpYmlsaXR5U3RyaW5nKSB7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUudHJhbnNpdGlvbiA9IGNvbXBhdGliaWxpdHlTdHJpbmc7XG4gICAgfVxuICAgIGVsZW1lbnQuc3R5bGUudHJhbnNpdGlvbiA9IHRyYW5zaXRpb25TdHJpbmc7XG4gICAgZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG5cbiAgICBmb3IgKGxldCBwcm9wIGluIGVuZFByb3BzKSB7XG4gICAgICAgIGlmIChwcm9wID09PSBcInRyYW5zZm9ybVwiKSB7XG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IGVuZFByb3BzW3Byb3BdO1xuICAgICAgICB9XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgICAoZWxlbWVudC5zdHlsZSBhcyBhbnkpW3Byb3BdID0gZW5kUHJvcHNbcHJvcF07XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBlbmRDYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiICYmIGVuZEFmdGVyKSB7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBlbmRDYWxsYmFjayAmJiBlbmRDYWxsYmFjaygpO1xuICAgICAgICB9LCBlbmRBZnRlcik7XG4gICAgfVxufTtcblxuLyoqXG4gKiBVc2VkIGJ5IE1heWVycyBmb3IgbGVhdmluZyBhbmltYXRpb25cbiAqXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBkb21cbiAqIEBwYXJhbSB7aW50fSB3aWR0aFxuICogQHBhcmFtIHtpbnR9IGhlaWdodFxuICogQHBhcmFtIHtpbnR9IHQgdGltZSBpbiBtaWxpc2Vjb25kc1xuICogQHBhcmFtIHtzdHJpbmd9IGhlYWRUbyB0b3AsYm90dG9tLGxlZnQscmlnaHRcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuQWlyckZYLmRvT3ZlcmxheU91dEFuaW1hdGlvbiA9IGZ1bmN0aW9uKFxuICAgIGRvbTogSFRNTEVsZW1lbnQsXG4gICAgd2lkdGg6IG51bWJlcixcbiAgICBoZWlnaHQ6IG51bWJlcixcbiAgICB0OiBudW1iZXIsXG4gICAgaGVhZFRvOiBQbGFjZW1lbnQsXG4gICAgY2FsbGJhY2s6ICgpID0+IHZvaWRcbikge1xuICAgIGxldCBzdGFydFByb3BzID0geyBvcGFjaXR5OiBcIjFcIiB9O1xuICAgIGxldCBlbmRQcm9wcyA9IHsgekluZGV4OiBcIjEwMlwiLCBvcGFjaXR5OiBcIjBcIiwgd2Via2l0VHJhbnNmb3JtOiBcIlwiLCB0cmFuc2Zvcm06IFwiXCIgfTtcblxuICAgIGlmIChbXCJ0b3BcIiwgXCJib3R0b21cIl0uaW5jbHVkZXMoaGVhZFRvKSkge1xuICAgICAgICBpZiAoaGVhZFRvID09PSBcInRvcFwiKSB7XG4gICAgICAgICAgICBlbmRQcm9wcy53ZWJraXRUcmFuc2Zvcm0gPSBcInNjYWxlKDAsIDEpIHRyYW5zbGF0ZTNkKDAsLVwiICsgaGVpZ2h0ICsgXCJweCwwKVwiO1xuICAgICAgICAgICAgZW5kUHJvcHMudHJhbnNmb3JtID0gXCJzY2FsZSgwLCAxKSB0cmFuc2xhdGUzZCgwLC1cIiArIGhlaWdodCArIFwicHgsMClcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVuZFByb3BzLndlYmtpdFRyYW5zZm9ybSA9IFwic2NhbGUoMCwgMSkgdHJhbnNsYXRlM2QoMCxcIiArIGhlaWdodCArIFwicHgsMClcIjtcbiAgICAgICAgICAgIGVuZFByb3BzLnRyYW5zZm9ybSA9IFwic2NhbGUoMCwgMSkgdHJhbnNsYXRlM2QoMCxcIiArIGhlaWdodCArIFwicHgsMClcIjtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChoZWFkVG8gPT09IFwibGVmdFwiKSB7XG4gICAgICAgICAgICBlbmRQcm9wcy53ZWJraXRUcmFuc2Zvcm0gPSBcInNjYWxlKDEsIDApIHRyYW5zbGF0ZTNkKC1cIiArIHdpZHRoICsgXCJweCwwLDApXCI7XG4gICAgICAgICAgICBlbmRQcm9wcy50cmFuc2Zvcm0gPSBcInNjYWxlKDEsIDApIHRyYW5zbGF0ZTNkKC1cIiArIHdpZHRoICsgXCJweCwwLDApXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbmRQcm9wcy53ZWJraXRUcmFuc2Zvcm0gPSBcInNjYWxlKDEsIDApIHRyYW5zbGF0ZTNkKFwiICsgd2lkdGggKyBcInB4LDAsMClcIjtcbiAgICAgICAgICAgIGVuZFByb3BzLnRyYW5zZm9ybSA9IFwic2NhbGUoMSwgMCkgdHJhbnNsYXRlM2QoXCIgKyB3aWR0aCArIFwicHgsMCwwKVwiO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQWlyckZYLmRvVHJhbnNpdGlvbkFuaW1hdGlvbihcbiAgICAgICAgZG9tLFxuICAgICAgICBzdGFydFByb3BzIGFzIENTU1N0cmluZ1Byb3BlcnRpZXMsXG4gICAgICAgIFtgb3BhY2l0eSAke3R9bXMgZWFzZS1vdXRgLCBgdHJhbnNmb3JtICR7dH1tcyBlYXNlLW91dGBdLFxuICAgICAgICBlbmRQcm9wcyBhcyBDU1NTdHJpbmdQcm9wZXJ0aWVzLFxuICAgICAgICBudWxsLFxuICAgICAgICB0LFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICBkb20uc3R5bGUuY3NzVGV4dCA9IFwiXCI7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICApO1xufTtcblxuLyoqXG4gKiBVc2VkIGJ5IE1heWVycyBmb3IgZW50ZXJpbmcgYW5pbWF0aW9uXG4gKlxuICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZG9tXG4gKiBAcGFyYW0ge2ludH0gd2lkdGhcbiAqIEBwYXJhbSB7aW50fSBoZWlnaHRcbiAqIEBwYXJhbSB7aW50fSB0IHRpbWUgaW4gbWlsaXNlY29uZHNcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBlYXJGcm9tIHRvcCxib3R0b20sbGVmdCxyaWdodCBkaXJlY3Rpb24gZnJvbSB3aGljaCBlbGVtZW50IHdpbGwgYXBwZWFyIG9uIHRoZSBzY3JlZW5cbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuQWlyckZYLmRvT3ZlcmxheUluQW5pbWF0aW9uID0gZnVuY3Rpb24oXG4gICAgZG9tOiBIVE1MRWxlbWVudCxcbiAgICB3aWR0aDogbnVtYmVyLFxuICAgIGhlaWdodDogbnVtYmVyLFxuICAgIHQ6IG51bWJlcixcbiAgICBhcHBlYXJGcm9tOiBQbGFjZW1lbnQsXG4gICAgY2FsbGJhY2s/OiAoKSA9PiB2b2lkXG4pIHtcbiAgICBsZXQgc3RhcnRQcm9wcyA9IHsgb3BhY2l0eTogXCIwXCIsIHdlYmtpdFRyYW5zZm9ybTogXCJcIiwgdHJhbnNmb3JtOiBcIlwiIH07XG5cbiAgICBpZiAoW1widG9wXCIsIFwiYm90dG9tXCJdLmluY2x1ZGVzKGFwcGVhckZyb20pKSB7XG4gICAgICAgIGlmIChhcHBlYXJGcm9tID09PSBcImJvdHRvbVwiKSB7XG4gICAgICAgICAgICBzdGFydFByb3BzLndlYmtpdFRyYW5zZm9ybSA9IFwic2NhbGUoMCwgMSkgdHJhbnNsYXRlM2QoMCxcIiArIGhlaWdodCArIFwicHgsMClcIjtcbiAgICAgICAgICAgIHN0YXJ0UHJvcHMudHJhbnNmb3JtID0gXCJzY2FsZSgwLCAxKSB0cmFuc2xhdGUzZCgwLFwiICsgaGVpZ2h0ICsgXCJweCwwKVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RhcnRQcm9wcy53ZWJraXRUcmFuc2Zvcm0gPSBcInNjYWxlKDAsIDEpIHRyYW5zbGF0ZTNkKDAsXCIgKyAtMSAqIGhlaWdodCArIFwicHgsMClcIjtcbiAgICAgICAgICAgIHN0YXJ0UHJvcHMudHJhbnNmb3JtID0gXCJzY2FsZSgwLCAxKSB0cmFuc2xhdGUzZCgwLFwiICsgLTEgKiBoZWlnaHQgKyBcInB4LDApXCI7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoYXBwZWFyRnJvbSA9PT0gXCJyaWdodFwiKSB7XG4gICAgICAgICAgICBzdGFydFByb3BzLndlYmtpdFRyYW5zZm9ybSA9IFwic2NhbGUoMSwgMCkgdHJhbnNsYXRlM2QoXCIgKyB3aWR0aCArIFwicHgsMCwwKVwiO1xuICAgICAgICAgICAgc3RhcnRQcm9wcy50cmFuc2Zvcm0gPSBcInNjYWxlKDEsIDApIHRyYW5zbGF0ZTNkKFwiICsgd2lkdGggKyBcInB4LDAsMClcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0YXJ0UHJvcHMud2Via2l0VHJhbnNmb3JtID0gXCJzY2FsZSgxLCAwKSB0cmFuc2xhdGUzZChcIiArIC0xICogd2lkdGggKyBcInB4LDAsMClcIjtcbiAgICAgICAgICAgIHN0YXJ0UHJvcHMudHJhbnNmb3JtID0gXCJzY2FsZSgxLCAwKSB0cmFuc2xhdGUzZChcIiArIC0xICogd2lkdGggKyBcInB4LDAsMClcIjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGVuZFByb3BzID0ge1xuICAgICAgICB6SW5kZXg6IFwiMTAyXCIsXG4gICAgICAgIHdlYmtpdFRyYW5zZm9ybTogXCJzY2FsZSgxLCAxKSB0cmFuc2xhdGUzZCgwLDAsMClcIixcbiAgICAgICAgdHJhbnNmb3JtOiBcInNjYWxlKDEsIDEpIHRyYW5zbGF0ZTNkKDAsMCwwKVwiLFxuICAgICAgICBvcGFjaXR5OiBcIjFcIlxuICAgIH07XG5cbiAgICBBaXJyRlguZG9UcmFuc2l0aW9uQW5pbWF0aW9uKFxuICAgICAgICBkb20sXG4gICAgICAgIHN0YXJ0UHJvcHMgYXMgQ1NTU3RyaW5nUHJvcGVydGllcyxcbiAgICAgICAgW2BvcGFjaXR5ICR7dH1tcyBlYXNlLW91dGAsIGB0cmFuc2Zvcm0gJHt0fW1zIGVhc2Utb3V0YF0sXG4gICAgICAgIGVuZFByb3BzIGFzIENTU1N0cmluZ1Byb3BlcnRpZXMsXG4gICAgICAgIG51bGwsXG4gICAgICAgIHQsXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIGRvbS5zdHlsZS5jc3NUZXh0ID0gXCJcIjtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59O1xuXG4vKipcbiAqIFVzZWQgZm9yIGFuaW1hdGluZyBzY3JvbGwgaW4gdmVydGljYWwgYXhpc1xuICpcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnRcbiAqIEBwYXJhbSB7aW50fSBzY3JvbGxEdXJhdGlvbiB0aW1lIGluIG1pbGlzZWNvbmRzXG4gKiBAcGFyYW0ge3N0cmluZ30gZGlyZWN0aW9uIHRvcCBvciBib3R0b21cbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5BaXJyRlguZG9WZXJ0aWNhbFNjcm9sbEFuaW1hdGlvbiA9IGZ1bmN0aW9uKFxuICAgIGVsZW1lbnQ6IEhUTUxFbGVtZW50LFxuICAgIHNjcm9sbER1cmF0aW9uOiBudW1iZXIsXG4gICAgZGlyZWN0aW9uOiBQbGFjZW1lbnRcbikge1xuICAgIGlmIChbXCJ0b3BcIiwgXCJib3R0b21cIl0uaW5kZXhPZihkaXJlY3Rpb24pID09PSAtMSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGRpcmVjdGlvbiBwYXJhbWV0ZXIgc3BlY2llZmllZFwiKTtcbiAgICB9XG5cbiAgICBsZXQgc2Nyb2xsSGVpZ2h0ID0gZWxlbWVudC5zY3JvbGxIZWlnaHQsXG4gICAgICAgIHNjcm9sbFN0ZXAgPSBNYXRoLlBJIC8gKHNjcm9sbER1cmF0aW9uIC8gMTUpLFxuICAgICAgICBjb3NQYXJhbWV0ZXIgPSBzY3JvbGxIZWlnaHQgLyAyLFxuICAgICAgICBzY3JvbGxDb3VudCA9IDAsXG4gICAgICAgIHNjcm9sbE1hcmdpbixcbiAgICAgICAgc2Nyb2xsRW5kID0gZGlyZWN0aW9uID09PSBcInRvcFwiID8gMCA6IHNjcm9sbEhlaWdodCAtIGVsZW1lbnQucGFyZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XG4gICAgbGV0IHNjcm9sbEludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICBpZiAoZWxlbWVudC5zY3JvbGxUb3AgIT09IHNjcm9sbEVuZCkge1xuICAgICAgICAgICAgc2Nyb2xsQ291bnQgKz0gMTtcbiAgICAgICAgICAgIHNjcm9sbE1hcmdpbiA9IGNvc1BhcmFtZXRlciAtIGNvc1BhcmFtZXRlciAqIE1hdGguY29zKHNjcm9sbENvdW50ICogc2Nyb2xsU3RlcCk7XG5cbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09IFwidG9wXCIpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnNjcm9sbFRvcCA9IGVsZW1lbnQuc2Nyb2xsVG9wIC0gc2Nyb2xsTWFyZ2luO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnNjcm9sbFRvcCA9IGVsZW1lbnQuc2Nyb2xsVG9wICsgc2Nyb2xsTWFyZ2luO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChzY3JvbGxJbnRlcnZhbCk7XG4gICAgICAgIH1cbiAgICB9LCAxNSk7XG59O1xuIl19