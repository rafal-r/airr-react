"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = AirrFX;

/**
 * Animation utiliy class. Performs css based transition animations
 */
function AirrFX() {}
/**
 * Animate passed HTML element with power of css transitions
 *
 * @param {HTMLElement} element
 * @param {object} startProps css properties that will be set prior the animation
 * @param {array} transitionProps array of css transition definitions, e.g. ['opacity 700ms ease-in', 'transform .4s ease-out']. Compatibility props like `-webkit-transform` are not needed as they will be added automatically
 * @param {object} endProps target css properties values that animation will go to
 * @param {function} preAnimationCallback callback to call before animation begins
 * @param {integer} endAfter time in miliseconds after which `endCallback` will be invoke
 * @param {function} endCallback function to call after endAfter time parameter is gone
 * @returns {void}
 */


AirrFX.doTransitionAnimation = function (element, startProps, transitionProps, endProps, preAnimationCallback, endAfter, endCallback) {
  element.style.webkitTransition = "none";
  element.style.transition = "none";
  element.offsetHeight;
  element.style.webkitBackfaceVisibility = "hidden";
  element.style.backfaceVisibility = "hidden";

  for (var prop in startProps) {
    if (prop === "transform") {
      element.style.webkitTransform = startProps[prop];
    } // eslint-disable-next-line


    element.style[prop] = startProps[prop];
  }

  var compatibilityString = null;
  var transitionString = transitionProps.join(",");

  if (transitionString.indexOf("transform") !== -1 && transitionString.indexOf("-webkit-transform") === -1) {
    compatibilityString = transitionString.replace("transform", "-webkit-transform");
  }

  if (typeof preAnimationCallback === "function") {
    preAnimationCallback();
  }

  element.offsetHeight;

  if (compatibilityString) {
    element.style.webkitTransition = compatibilityString;
  }

  element.style.webkitTransition = transitionString;

  if (compatibilityString) {
    element.style.transition = compatibilityString;
  }

  element.style.transition = transitionString;
  element.offsetHeight;

  for (var _prop in endProps) {
    if (_prop === "transform") {
      element.style.webkitTransform = endProps[_prop];
    } // eslint-disable-next-line


    element.style[_prop] = endProps[_prop];
  }

  if (typeof endCallback === "function" && endAfter) {
    setTimeout(function () {
      endCallback && endCallback();
    }, endAfter);
  }
};
/**
 * Used by Mayers for leaving animation
 *
 * @param {HTMLElement} dom
 * @param {int} width
 * @param {int} height
 * @param {int} t time in miliseconds
 * @param {string} headTo top,bottom,left,right
 * @param {function} callback
 * @returns {void}
 */


AirrFX.doOverlayOutAnimation = function (dom, width, height, t, headTo, callback) {
  var startProps = {
    opacity: "1"
  };
  var endProps = {
    zIndex: "102",
    opacity: "0",
    webkitTransform: "",
    transform: ""
  };

  if (["top", "bottom"].includes(headTo)) {
    if (headTo === "top") {
      endProps.webkitTransform = "scale(0, 1) translate3d(0,-" + height + "px,0)";
      endProps.transform = "scale(0, 1) translate3d(0,-" + height + "px,0)";
    } else {
      endProps.webkitTransform = "scale(0, 1) translate3d(0," + height + "px,0)";
      endProps.transform = "scale(0, 1) translate3d(0," + height + "px,0)";
    }
  } else {
    if (headTo === "left") {
      endProps.webkitTransform = "scale(1, 0) translate3d(-" + width + "px,0,0)";
      endProps.transform = "scale(1, 0) translate3d(-" + width + "px,0,0)";
    } else {
      endProps.webkitTransform = "scale(1, 0) translate3d(" + width + "px,0,0)";
      endProps.transform = "scale(1, 0) translate3d(" + width + "px,0,0)";
    }
  }

  AirrFX.doTransitionAnimation(dom, startProps, ["opacity ".concat(t, "ms ease-out"), "transform ".concat(t, "ms ease-out")], endProps, null, t, function () {
    dom.style.cssText = "";

    if (typeof callback === "function") {
      callback();
    }
  });
};
/**
 * Used by Mayers for entering animation
 *
 * @param {HTMLElement} dom
 * @param {int} width
 * @param {int} height
 * @param {int} t time in miliseconds
 * @param {string} appearFrom top,bottom,left,right direction from which element will appear on the screen
 * @param {function} callback
 * @returns {void}
 */


AirrFX.doOverlayInAnimation = function (dom, width, height, t, appearFrom, callback) {
  var startProps = {
    opacity: "0",
    webkitTransform: "",
    transform: ""
  };

  if (["top", "bottom"].includes(appearFrom)) {
    if (appearFrom === "bottom") {
      startProps.webkitTransform = "scale(0, 1) translate3d(0," + height + "px,0)";
      startProps.transform = "scale(0, 1) translate3d(0," + height + "px,0)";
    } else {
      startProps.webkitTransform = "scale(0, 1) translate3d(0," + -1 * height + "px,0)";
      startProps.transform = "scale(0, 1) translate3d(0," + -1 * height + "px,0)";
    }
  } else {
    if (appearFrom === "right") {
      startProps.webkitTransform = "scale(1, 0) translate3d(" + width + "px,0,0)";
      startProps.transform = "scale(1, 0) translate3d(" + width + "px,0,0)";
    } else {
      startProps.webkitTransform = "scale(1, 0) translate3d(" + -1 * width + "px,0,0)";
      startProps.transform = "scale(1, 0) translate3d(" + -1 * width + "px,0,0)";
    }
  }

  var endProps = {
    zIndex: "102",
    webkitTransform: "scale(1, 1) translate3d(0,0,0)",
    transform: "scale(1, 1) translate3d(0,0,0)",
    opacity: "1"
  };
  AirrFX.doTransitionAnimation(dom, startProps, ["opacity ".concat(t, "ms ease-out"), "transform ".concat(t, "ms ease-out")], endProps, null, t, function () {
    dom.style.cssText = "";

    if (typeof callback === "function") {
      callback();
    }
  });
};
/**
 * Used for animating scroll in vertical axis
 *
 * @param {HTMLElement} element
 * @param {int} scrollDuration time in miliseconds
 * @param {string} direction top or bottom
 * @returns {void}
 */


AirrFX.doVerticalScrollAnimation = function (element, scrollDuration, direction) {
  if (["top", "bottom"].indexOf(direction) === -1) {
    throw new Error("Invalid direction parameter speciefied");
  }

  var scrollHeight = element.scrollHeight,
      scrollStep = Math.PI / (scrollDuration / 15),
      cosParameter = scrollHeight / 2,
      scrollCount = 0,
      scrollMargin,
      scrollEnd = direction === "top" ? 0 : scrollHeight - element.parentElement.clientHeight;
  var scrollInterval = setInterval(function () {
    if (element.scrollTop !== scrollEnd) {
      scrollCount += 1;
      scrollMargin = cosParameter - cosParameter * Math.cos(scrollCount * scrollStep);

      if (direction === "top") {
        element.scrollTop = element.scrollTop - scrollMargin;
      } else {
        element.scrollTop = element.scrollTop + scrollMargin;
      }
    } else {
      clearInterval(scrollInterval);
    }
  }, 15);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9BaXJyRlgudHMiXSwibmFtZXMiOlsiQWlyckZYIiwiZG9UcmFuc2l0aW9uQW5pbWF0aW9uIiwiZWxlbWVudCIsInN0YXJ0UHJvcHMiLCJ0cmFuc2l0aW9uUHJvcHMiLCJlbmRQcm9wcyIsInByZUFuaW1hdGlvbkNhbGxiYWNrIiwiZW5kQWZ0ZXIiLCJlbmRDYWxsYmFjayIsInN0eWxlIiwid2Via2l0VHJhbnNpdGlvbiIsInRyYW5zaXRpb24iLCJvZmZzZXRIZWlnaHQiLCJ3ZWJraXRCYWNrZmFjZVZpc2liaWxpdHkiLCJiYWNrZmFjZVZpc2liaWxpdHkiLCJwcm9wIiwid2Via2l0VHJhbnNmb3JtIiwiY29tcGF0aWJpbGl0eVN0cmluZyIsInRyYW5zaXRpb25TdHJpbmciLCJqb2luIiwiaW5kZXhPZiIsInJlcGxhY2UiLCJzZXRUaW1lb3V0IiwiZG9PdmVybGF5T3V0QW5pbWF0aW9uIiwiZG9tIiwid2lkdGgiLCJoZWlnaHQiLCJ0IiwiaGVhZFRvIiwiY2FsbGJhY2siLCJvcGFjaXR5IiwiekluZGV4IiwidHJhbnNmb3JtIiwiaW5jbHVkZXMiLCJjc3NUZXh0IiwiZG9PdmVybGF5SW5BbmltYXRpb24iLCJhcHBlYXJGcm9tIiwiZG9WZXJ0aWNhbFNjcm9sbEFuaW1hdGlvbiIsInNjcm9sbER1cmF0aW9uIiwiZGlyZWN0aW9uIiwiRXJyb3IiLCJzY3JvbGxIZWlnaHQiLCJzY3JvbGxTdGVwIiwiTWF0aCIsIlBJIiwiY29zUGFyYW1ldGVyIiwic2Nyb2xsQ291bnQiLCJzY3JvbGxNYXJnaW4iLCJzY3JvbGxFbmQiLCJwYXJlbnRFbGVtZW50IiwiY2xpZW50SGVpZ2h0Iiwic2Nyb2xsSW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsInNjcm9sbFRvcCIsImNvcyIsImNsZWFySW50ZXJ2YWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFQTs7O0FBR2UsU0FBU0EsTUFBVCxHQUF3QixDQUFFO0FBRXpDOzs7Ozs7Ozs7Ozs7OztBQVlBQSxNQUFNLENBQUND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LCBDU1NTdHJpbmdQcm9wZXJ0aWVzIH0gZnJvbSBcIi4vVHlwZXNcIjtcblxuLyoqXG4gKiBBbmltYXRpb24gdXRpbGl5IGNsYXNzLiBQZXJmb3JtcyBjc3MgYmFzZWQgdHJhbnNpdGlvbiBhbmltYXRpb25zXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIEFpcnJGWCgpOiB2b2lkIHt9XG5cbi8qKlxuICogQW5pbWF0ZSBwYXNzZWQgSFRNTCBlbGVtZW50IHdpdGggcG93ZXIgb2YgY3NzIHRyYW5zaXRpb25zXG4gKlxuICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudFxuICogQHBhcmFtIHtvYmplY3R9IHN0YXJ0UHJvcHMgY3NzIHByb3BlcnRpZXMgdGhhdCB3aWxsIGJlIHNldCBwcmlvciB0aGUgYW5pbWF0aW9uXG4gKiBAcGFyYW0ge2FycmF5fSB0cmFuc2l0aW9uUHJvcHMgYXJyYXkgb2YgY3NzIHRyYW5zaXRpb24gZGVmaW5pdGlvbnMsIGUuZy4gWydvcGFjaXR5IDcwMG1zIGVhc2UtaW4nLCAndHJhbnNmb3JtIC40cyBlYXNlLW91dCddLiBDb21wYXRpYmlsaXR5IHByb3BzIGxpa2UgYC13ZWJraXQtdHJhbnNmb3JtYCBhcmUgbm90IG5lZWRlZCBhcyB0aGV5IHdpbGwgYmUgYWRkZWQgYXV0b21hdGljYWxseVxuICogQHBhcmFtIHtvYmplY3R9IGVuZFByb3BzIHRhcmdldCBjc3MgcHJvcGVydGllcyB2YWx1ZXMgdGhhdCBhbmltYXRpb24gd2lsbCBnbyB0b1xuICogQHBhcmFtIHtmdW5jdGlvbn0gcHJlQW5pbWF0aW9uQ2FsbGJhY2sgY2FsbGJhY2sgdG8gY2FsbCBiZWZvcmUgYW5pbWF0aW9uIGJlZ2luc1xuICogQHBhcmFtIHtpbnRlZ2VyfSBlbmRBZnRlciB0aW1lIGluIG1pbGlzZWNvbmRzIGFmdGVyIHdoaWNoIGBlbmRDYWxsYmFja2Agd2lsbCBiZSBpbnZva2VcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGVuZENhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhbGwgYWZ0ZXIgZW5kQWZ0ZXIgdGltZSBwYXJhbWV0ZXIgaXMgZ29uZVxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbkFpcnJGWC5kb1RyYW5zaXRpb25BbmltYXRpb24gPSBmdW5jdGlvbihcbiAgICBlbGVtZW50OiBIVE1MRWxlbWVudCxcbiAgICBzdGFydFByb3BzOiBDU1NTdHJpbmdQcm9wZXJ0aWVzLFxuICAgIHRyYW5zaXRpb25Qcm9wczogc3RyaW5nW10sXG4gICAgZW5kUHJvcHM6IENTU1N0cmluZ1Byb3BlcnRpZXMsXG4gICAgcHJlQW5pbWF0aW9uQ2FsbGJhY2s/OiAoKSA9PiB2b2lkLFxuICAgIGVuZEFmdGVyPzogbnVtYmVyLFxuICAgIGVuZENhbGxiYWNrPzogKCkgPT4gdm9pZFxuKTogdm9pZCB7XG4gICAgZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2l0aW9uID0gXCJub25lXCI7XG4gICAgZWxlbWVudC5zdHlsZS50cmFuc2l0aW9uID0gXCJub25lXCI7XG4gICAgZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG5cbiAgICBlbGVtZW50LnN0eWxlLndlYmtpdEJhY2tmYWNlVmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gICAgZWxlbWVudC5zdHlsZS5iYWNrZmFjZVZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICAgIGZvciAobGV0IHByb3AgaW4gc3RhcnRQcm9wcykge1xuICAgICAgICBpZiAocHJvcCA9PT0gXCJ0cmFuc2Zvcm1cIikge1xuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSBzdGFydFByb3BzW3Byb3BdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICAgIChlbGVtZW50LnN0eWxlIGFzIGFueSlbcHJvcF0gPSBzdGFydFByb3BzW3Byb3BdO1xuICAgIH1cbiAgICBsZXQgY29tcGF0aWJpbGl0eVN0cmluZyA9IG51bGw7XG4gICAgbGV0IHRyYW5zaXRpb25TdHJpbmcgPSB0cmFuc2l0aW9uUHJvcHMuam9pbihcIixcIik7XG5cbiAgICBpZiAoXG4gICAgICAgIHRyYW5zaXRpb25TdHJpbmcuaW5kZXhPZihcInRyYW5zZm9ybVwiKSAhPT0gLTEgJiZcbiAgICAgICAgdHJhbnNpdGlvblN0cmluZy5pbmRleE9mKFwiLXdlYmtpdC10cmFuc2Zvcm1cIikgPT09IC0xXG4gICAgKSB7XG4gICAgICAgIGNvbXBhdGliaWxpdHlTdHJpbmcgPSB0cmFuc2l0aW9uU3RyaW5nLnJlcGxhY2UoXCJ0cmFuc2Zvcm1cIiwgXCItd2Via2l0LXRyYW5zZm9ybVwiKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHByZUFuaW1hdGlvbkNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgcHJlQW5pbWF0aW9uQ2FsbGJhY2soKTtcbiAgICB9XG5cbiAgICBlbGVtZW50Lm9mZnNldEhlaWdodDtcblxuICAgIGlmIChjb21wYXRpYmlsaXR5U3RyaW5nKSB7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUud2Via2l0VHJhbnNpdGlvbiA9IGNvbXBhdGliaWxpdHlTdHJpbmc7XG4gICAgfVxuXG4gICAgZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2l0aW9uID0gdHJhbnNpdGlvblN0cmluZztcbiAgICBpZiAoY29tcGF0aWJpbGl0eVN0cmluZykge1xuICAgICAgICBlbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSBjb21wYXRpYmlsaXR5U3RyaW5nO1xuICAgIH1cbiAgICBlbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSB0cmFuc2l0aW9uU3RyaW5nO1xuICAgIGVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuXG4gICAgZm9yIChsZXQgcHJvcCBpbiBlbmRQcm9wcykge1xuICAgICAgICBpZiAocHJvcCA9PT0gXCJ0cmFuc2Zvcm1cIikge1xuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSBlbmRQcm9wc1twcm9wXTtcbiAgICAgICAgfVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgICAgKGVsZW1lbnQuc3R5bGUgYXMgYW55KVtwcm9wXSA9IGVuZFByb3BzW3Byb3BdO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZW5kQ2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIiAmJiBlbmRBZnRlcikge1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCk6IHZvaWQge1xuICAgICAgICAgICAgZW5kQ2FsbGJhY2sgJiYgZW5kQ2FsbGJhY2soKTtcbiAgICAgICAgfSwgZW5kQWZ0ZXIpO1xuICAgIH1cbn07XG5cbi8qKlxuICogVXNlZCBieSBNYXllcnMgZm9yIGxlYXZpbmcgYW5pbWF0aW9uXG4gKlxuICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZG9tXG4gKiBAcGFyYW0ge2ludH0gd2lkdGhcbiAqIEBwYXJhbSB7aW50fSBoZWlnaHRcbiAqIEBwYXJhbSB7aW50fSB0IHRpbWUgaW4gbWlsaXNlY29uZHNcbiAqIEBwYXJhbSB7c3RyaW5nfSBoZWFkVG8gdG9wLGJvdHRvbSxsZWZ0LHJpZ2h0XG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbkFpcnJGWC5kb092ZXJsYXlPdXRBbmltYXRpb24gPSBmdW5jdGlvbihcbiAgICBkb206IEhUTUxFbGVtZW50LFxuICAgIHdpZHRoOiBudW1iZXIsXG4gICAgaGVpZ2h0OiBudW1iZXIsXG4gICAgdDogbnVtYmVyLFxuICAgIGhlYWRUbzogUGxhY2VtZW50LFxuICAgIGNhbGxiYWNrOiAoKSA9PiB2b2lkXG4pOiB2b2lkIHtcbiAgICBsZXQgc3RhcnRQcm9wcyA9IHsgb3BhY2l0eTogXCIxXCIgfTtcbiAgICBsZXQgZW5kUHJvcHMgPSB7IHpJbmRleDogXCIxMDJcIiwgb3BhY2l0eTogXCIwXCIsIHdlYmtpdFRyYW5zZm9ybTogXCJcIiwgdHJhbnNmb3JtOiBcIlwiIH07XG5cbiAgICBpZiAoW1widG9wXCIsIFwiYm90dG9tXCJdLmluY2x1ZGVzKGhlYWRUbykpIHtcbiAgICAgICAgaWYgKGhlYWRUbyA9PT0gXCJ0b3BcIikge1xuICAgICAgICAgICAgZW5kUHJvcHMud2Via2l0VHJhbnNmb3JtID0gXCJzY2FsZSgwLCAxKSB0cmFuc2xhdGUzZCgwLC1cIiArIGhlaWdodCArIFwicHgsMClcIjtcbiAgICAgICAgICAgIGVuZFByb3BzLnRyYW5zZm9ybSA9IFwic2NhbGUoMCwgMSkgdHJhbnNsYXRlM2QoMCwtXCIgKyBoZWlnaHQgKyBcInB4LDApXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbmRQcm9wcy53ZWJraXRUcmFuc2Zvcm0gPSBcInNjYWxlKDAsIDEpIHRyYW5zbGF0ZTNkKDAsXCIgKyBoZWlnaHQgKyBcInB4LDApXCI7XG4gICAgICAgICAgICBlbmRQcm9wcy50cmFuc2Zvcm0gPSBcInNjYWxlKDAsIDEpIHRyYW5zbGF0ZTNkKDAsXCIgKyBoZWlnaHQgKyBcInB4LDApXCI7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaGVhZFRvID09PSBcImxlZnRcIikge1xuICAgICAgICAgICAgZW5kUHJvcHMud2Via2l0VHJhbnNmb3JtID0gXCJzY2FsZSgxLCAwKSB0cmFuc2xhdGUzZCgtXCIgKyB3aWR0aCArIFwicHgsMCwwKVwiO1xuICAgICAgICAgICAgZW5kUHJvcHMudHJhbnNmb3JtID0gXCJzY2FsZSgxLCAwKSB0cmFuc2xhdGUzZCgtXCIgKyB3aWR0aCArIFwicHgsMCwwKVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZW5kUHJvcHMud2Via2l0VHJhbnNmb3JtID0gXCJzY2FsZSgxLCAwKSB0cmFuc2xhdGUzZChcIiArIHdpZHRoICsgXCJweCwwLDApXCI7XG4gICAgICAgICAgICBlbmRQcm9wcy50cmFuc2Zvcm0gPSBcInNjYWxlKDEsIDApIHRyYW5zbGF0ZTNkKFwiICsgd2lkdGggKyBcInB4LDAsMClcIjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEFpcnJGWC5kb1RyYW5zaXRpb25BbmltYXRpb24oXG4gICAgICAgIGRvbSxcbiAgICAgICAgc3RhcnRQcm9wcyBhcyBDU1NTdHJpbmdQcm9wZXJ0aWVzLFxuICAgICAgICBbYG9wYWNpdHkgJHt0fW1zIGVhc2Utb3V0YCwgYHRyYW5zZm9ybSAke3R9bXMgZWFzZS1vdXRgXSxcbiAgICAgICAgZW5kUHJvcHMgYXMgQ1NTU3RyaW5nUHJvcGVydGllcyxcbiAgICAgICAgbnVsbCxcbiAgICAgICAgdCxcbiAgICAgICAgKCk6IHZvaWQgPT4ge1xuICAgICAgICAgICAgZG9tLnN0eWxlLmNzc1RleHQgPSBcIlwiO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKTtcbn07XG5cbi8qKlxuICogVXNlZCBieSBNYXllcnMgZm9yIGVudGVyaW5nIGFuaW1hdGlvblxuICpcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGRvbVxuICogQHBhcmFtIHtpbnR9IHdpZHRoXG4gKiBAcGFyYW0ge2ludH0gaGVpZ2h0XG4gKiBAcGFyYW0ge2ludH0gdCB0aW1lIGluIG1pbGlzZWNvbmRzXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwZWFyRnJvbSB0b3AsYm90dG9tLGxlZnQscmlnaHQgZGlyZWN0aW9uIGZyb20gd2hpY2ggZWxlbWVudCB3aWxsIGFwcGVhciBvbiB0aGUgc2NyZWVuXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbkFpcnJGWC5kb092ZXJsYXlJbkFuaW1hdGlvbiA9IGZ1bmN0aW9uKFxuICAgIGRvbTogSFRNTEVsZW1lbnQsXG4gICAgd2lkdGg6IG51bWJlcixcbiAgICBoZWlnaHQ6IG51bWJlcixcbiAgICB0OiBudW1iZXIsXG4gICAgYXBwZWFyRnJvbTogUGxhY2VtZW50LFxuICAgIGNhbGxiYWNrPzogKCkgPT4gdm9pZFxuKTogdm9pZCB7XG4gICAgbGV0IHN0YXJ0UHJvcHMgPSB7IG9wYWNpdHk6IFwiMFwiLCB3ZWJraXRUcmFuc2Zvcm06IFwiXCIsIHRyYW5zZm9ybTogXCJcIiB9O1xuXG4gICAgaWYgKFtcInRvcFwiLCBcImJvdHRvbVwiXS5pbmNsdWRlcyhhcHBlYXJGcm9tKSkge1xuICAgICAgICBpZiAoYXBwZWFyRnJvbSA9PT0gXCJib3R0b21cIikge1xuICAgICAgICAgICAgc3RhcnRQcm9wcy53ZWJraXRUcmFuc2Zvcm0gPSBcInNjYWxlKDAsIDEpIHRyYW5zbGF0ZTNkKDAsXCIgKyBoZWlnaHQgKyBcInB4LDApXCI7XG4gICAgICAgICAgICBzdGFydFByb3BzLnRyYW5zZm9ybSA9IFwic2NhbGUoMCwgMSkgdHJhbnNsYXRlM2QoMCxcIiArIGhlaWdodCArIFwicHgsMClcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0YXJ0UHJvcHMud2Via2l0VHJhbnNmb3JtID0gXCJzY2FsZSgwLCAxKSB0cmFuc2xhdGUzZCgwLFwiICsgLTEgKiBoZWlnaHQgKyBcInB4LDApXCI7XG4gICAgICAgICAgICBzdGFydFByb3BzLnRyYW5zZm9ybSA9IFwic2NhbGUoMCwgMSkgdHJhbnNsYXRlM2QoMCxcIiArIC0xICogaGVpZ2h0ICsgXCJweCwwKVwiO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGFwcGVhckZyb20gPT09IFwicmlnaHRcIikge1xuICAgICAgICAgICAgc3RhcnRQcm9wcy53ZWJraXRUcmFuc2Zvcm0gPSBcInNjYWxlKDEsIDApIHRyYW5zbGF0ZTNkKFwiICsgd2lkdGggKyBcInB4LDAsMClcIjtcbiAgICAgICAgICAgIHN0YXJ0UHJvcHMudHJhbnNmb3JtID0gXCJzY2FsZSgxLCAwKSB0cmFuc2xhdGUzZChcIiArIHdpZHRoICsgXCJweCwwLDApXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdGFydFByb3BzLndlYmtpdFRyYW5zZm9ybSA9IFwic2NhbGUoMSwgMCkgdHJhbnNsYXRlM2QoXCIgKyAtMSAqIHdpZHRoICsgXCJweCwwLDApXCI7XG4gICAgICAgICAgICBzdGFydFByb3BzLnRyYW5zZm9ybSA9IFwic2NhbGUoMSwgMCkgdHJhbnNsYXRlM2QoXCIgKyAtMSAqIHdpZHRoICsgXCJweCwwLDApXCI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBlbmRQcm9wcyA9IHtcbiAgICAgICAgekluZGV4OiBcIjEwMlwiLFxuICAgICAgICB3ZWJraXRUcmFuc2Zvcm06IFwic2NhbGUoMSwgMSkgdHJhbnNsYXRlM2QoMCwwLDApXCIsXG4gICAgICAgIHRyYW5zZm9ybTogXCJzY2FsZSgxLCAxKSB0cmFuc2xhdGUzZCgwLDAsMClcIixcbiAgICAgICAgb3BhY2l0eTogXCIxXCJcbiAgICB9O1xuXG4gICAgQWlyckZYLmRvVHJhbnNpdGlvbkFuaW1hdGlvbihcbiAgICAgICAgZG9tLFxuICAgICAgICBzdGFydFByb3BzIGFzIENTU1N0cmluZ1Byb3BlcnRpZXMsXG4gICAgICAgIFtgb3BhY2l0eSAke3R9bXMgZWFzZS1vdXRgLCBgdHJhbnNmb3JtICR7dH1tcyBlYXNlLW91dGBdLFxuICAgICAgICBlbmRQcm9wcyBhcyBDU1NTdHJpbmdQcm9wZXJ0aWVzLFxuICAgICAgICBudWxsLFxuICAgICAgICB0LFxuICAgICAgICAoKTogdm9pZCA9PiB7XG4gICAgICAgICAgICBkb20uc3R5bGUuY3NzVGV4dCA9IFwiXCI7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICApO1xufTtcblxuLyoqXG4gKiBVc2VkIGZvciBhbmltYXRpbmcgc2Nyb2xsIGluIHZlcnRpY2FsIGF4aXNcbiAqXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gKiBAcGFyYW0ge2ludH0gc2Nyb2xsRHVyYXRpb24gdGltZSBpbiBtaWxpc2Vjb25kc1xuICogQHBhcmFtIHtzdHJpbmd9IGRpcmVjdGlvbiB0b3Agb3IgYm90dG9tXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuQWlyckZYLmRvVmVydGljYWxTY3JvbGxBbmltYXRpb24gPSBmdW5jdGlvbihcbiAgICBlbGVtZW50OiBIVE1MRWxlbWVudCxcbiAgICBzY3JvbGxEdXJhdGlvbjogbnVtYmVyLFxuICAgIGRpcmVjdGlvbjogUGxhY2VtZW50XG4pOiB2b2lkIHtcbiAgICBpZiAoW1widG9wXCIsIFwiYm90dG9tXCJdLmluZGV4T2YoZGlyZWN0aW9uKSA9PT0gLTEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBkaXJlY3Rpb24gcGFyYW1ldGVyIHNwZWNpZWZpZWRcIik7XG4gICAgfVxuXG4gICAgbGV0IHNjcm9sbEhlaWdodCA9IGVsZW1lbnQuc2Nyb2xsSGVpZ2h0LFxuICAgICAgICBzY3JvbGxTdGVwID0gTWF0aC5QSSAvIChzY3JvbGxEdXJhdGlvbiAvIDE1KSxcbiAgICAgICAgY29zUGFyYW1ldGVyID0gc2Nyb2xsSGVpZ2h0IC8gMixcbiAgICAgICAgc2Nyb2xsQ291bnQgPSAwLFxuICAgICAgICBzY3JvbGxNYXJnaW4sXG4gICAgICAgIHNjcm9sbEVuZCA9IGRpcmVjdGlvbiA9PT0gXCJ0b3BcIiA/IDAgOiBzY3JvbGxIZWlnaHQgLSBlbGVtZW50LnBhcmVudEVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuICAgIGxldCBzY3JvbGxJbnRlcnZhbCA9IHNldEludGVydmFsKCgpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKGVsZW1lbnQuc2Nyb2xsVG9wICE9PSBzY3JvbGxFbmQpIHtcbiAgICAgICAgICAgIHNjcm9sbENvdW50ICs9IDE7XG4gICAgICAgICAgICBzY3JvbGxNYXJnaW4gPSBjb3NQYXJhbWV0ZXIgLSBjb3NQYXJhbWV0ZXIgKiBNYXRoLmNvcyhzY3JvbGxDb3VudCAqIHNjcm9sbFN0ZXApO1xuXG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSBcInRvcFwiKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5zY3JvbGxUb3AgPSBlbGVtZW50LnNjcm9sbFRvcCAtIHNjcm9sbE1hcmdpbjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5zY3JvbGxUb3AgPSBlbGVtZW50LnNjcm9sbFRvcCArIHNjcm9sbE1hcmdpbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoc2Nyb2xsSW50ZXJ2YWwpO1xuICAgICAgICB9XG4gICAgfSwgMTUpO1xufTtcbiJdfQ==